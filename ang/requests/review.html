<header>
  <ol class="entry-meta breadcrumb">
    <li><a href="/dashboard">Dashboard</a></li>
    <li class="current">Request</li>
  </ol>
</header>

<section ng-if="r" id="review" class="{{reviewClass}}">

  <section id="info">
    <h5>{{ r.title || 'Spec' }}</h5>
    <request-review-summary></request-review-summary>
  </section>

  <section class="inactiveMSG">
    <h3>Too late ...</h3>
    <p>This request is no longer active. It's already been fulfiled, or solved.
    Gotta be fast these days, I tell ya :p
    </p>
  </section>

  <section ng-if="isExpert && isV0Expert" id="migrateMSG">
    <h2>Upgrade time</h2>
    <img src="https://cdn.andrewlorente.com/29589c30f9d971649e9c2463091e3ad2f18d4cbd" />
    <br /><br />
    <p>With the development of our social authoring system out of the way, we're excited to begin
    a long overdue 8-12 week effort to <b>10x</b> our expert experience.
    <p>Lots of features and new menu systems planned and we'll be
      building most of it open source!
      If you're as eager as JK for features to be appearing quicker,
      fork <b><a href="https://github.com/airpair/experts.airpair.com" target="_blank">our GitHub repo</a></b>.
    </p>
    <hr />
    One of the first things we're improving is this shabby MVP request-reply flow.
    We need you to add your location & timezone for the upcoming scheduling feature.
    Now's also a good time to re-auth your social profiles.
    Our matching alorithm is more likley to surface you with
    up to date social data.
    <a href="/be-an-expert" class="btn">Upgrade my profile</a>
  </section>

  <section ng-if="isExpert && expertEdit && !isV0Expert" id="reply">

    <form ng-if="data" id="replyForm" class="expertReplyForm" novalidate name="replyForm" ng-submit="submit(replyForm.$valid, data)">

    <h3>Do you want this AirPair?</h3>

    <div form-group class="expertStatus">
      <input form-control id="expertAvailable" name="expertStatus" ng-model="data.expertStatus" type="radio" value="available" required>
      <label for="expertAvailable">I'm Available</label>

      <input form-control id="expertBusy" name="expertStatus" ng-model="data.expertStatus" type="radio" value="busy" required>
      <label for="expertBusy">No thanks</label>

      <div class="error" ng-if="formGroup.showError(replyForm.expertStatus)" ng-messages="replyForm.expertStatus.$error">
          <div ng-message="required">Required</div>
      </div>
    </div>

    <hr />
    <div form-group ng-if="data.expertStatus">
      <label for="expertComment">Message to customer</label>
      <textarea form-control id="expertComment" name="expertComment" ng-model="data.expertComment"  required></textarea>
      <div class="error" ng-if="formGroup.showError(replyForm.expertComment)" ng-messages="replyForm.expertComment.$error">
          <div ng-message="required">Required</div>
      </div>
    </div>

    <div form-group ng-if="data.expertStatus == 'available'">
      <label for="expertAvailabilityTxt">Availability</label>
      <textarea form-control id="expertAvailabilityTxt" name="expertAvailability" ng-model="data.expertAvailability" required></textarea>
      <div class="error" ng-if="formGroup.showError(replyForm.expertAvailability)" ng-messages="replyForm.expertAvailability.$error">
      </div>
    </div>

    <button ng-if="(data.expertStatus && data.expertComment)" type="submit" class="btn btn-primary">Send reply</button>

  </form>

  </section>


  <section class="replies" ng-if="isAnon">
    <form>
      <h3>Want AirPairs like this?</h3>
      <ul>
        <li>- Get paid to help people</li>
        <li>- Sharpen your communication skills</li>
        <li>- Build your online developer cred</li>
      </ul>
      <a id="loginGoogleAuth" track-click="auth" class="btn btn-error" ng-href="{{'/v1/auth/google' + ((returnTo) ? '?returnTo='+returnTo : '') }}" target="_self" style="width:100%">Login with google to reply</a>
    </form>
  </section>


  <section ng-if="!isExpert && !isCustomer && !isAnon && !isAdmin" class="replies" ng-if="isAnon">
    <form>
      <h3>Want AirPairs like this?</h3>
      <ul>
        <li>- Get paid to help people</li>
        <li>- Sharpen your communication skills</li>
        <li>- Build your online developer cred</li>
      </ul>
      <a href="/be-an-expert" target="_self" class="btn" style="width:100%">Apply to be an AirPair expert</a>
    </form>
  </section>


  <!-- [[{{session.emailVerified}}::{{isCustomer}}]] -->
  <section class="replies" ng-if="!isAnon && !session.emailVerified">
    <div>
      <div class="message noexperts">
        <img class="user" itemprop="image" src="/static/img/css/chat/pairy.png" />
        <h4>Pairy</h4>
        <div><p ng-if="isCustomer" class="important">You must verify your email before experts can see this request.</p></div>
        <div><p ng-if="!isCustomer" class="important">You must verify your email before replying.</p></div>
      </div>
      <section>
        <strong>*</strong>
        <a href="/me" class="btn">Verify Email</a>

      </section>
    </div>
  </section>

  <section class="replies" ng-if="(isCustomer || isAdmin || (isExpert && !expertEdit)) && session.emailVerified">

    <div ng-if="(isCustomer || isAdmin) && replies == 0">
      <div class="message noexperts">
        <img class="user" itemprop="image" src="/static/img/css/chat/pairy.png" />
        <h4>Pairy</h4>
        <div><p>No experts have replied yet. <!-- Consider uping the rate? --></p></div>
      </div>
      <section>
        <a href="/help/request/{{r._id}}" class="btn">Edit request</a>
      </section>
    </div>

    <ul>
      <li ng-repeat="s in replies">
        <div>
          <div class="message noexperts">
            <img class="user" itemprop="image" ng-src="{{s.expert.avatar}}?s=100" />
            <h3>{{s.expert.name}}</h3>
            <social-links profile="s.expert"></social-links>
            <div><p>{{s.expertComment}}</p><p>{{s.expertAvailability}}</p></div>
          </div>
          <section ng-if="isExpert">
            <strong ng-if="s.expertStatus == 'available'">${{s.suggestedRate.expert}}<span>/hr</span></strong>
            <a ng-click="setExpertEdit()" class="btn">Edit reply</a>
          </section>
          <section ng-if="(isCustomer || isAdmin) && s.expertStatus == 'available'">
            <strong>${{s.suggestedRate.total}}<span>/hr</span></strong>
            <a href="/billing/book/{{s.expert._id}}/{{r._id}}" class="btn">Book</a>
            <!-- <a class="openchat" ng-click="openChat(s.expert.userId)">Chat with {{s.expert.name}}</a> -->
          </section>
        </div>
      </li>
    </ul>

  </section>

  <section id="brief">

    <div class="entry-author">
      <div class="message">
        <img class="entry-author-image user" itemprop="image" ng-src="{{ (r.by) ? r.by.avatar : r.company.contacts[0].pic }}?s=100" />
        <h4 ng-if="r.by.name">{{r.by.name}}</h4>
        <div ng-bind-html="r.brief | markdownHtml"></div>
      </div>
    </div>

  </section>

  <section id="expertReview">

  </section>

</section>


