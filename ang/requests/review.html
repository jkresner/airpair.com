<header>
  <ol class="entry-meta breadcrumb">
    <li><a href="/dashboard">Dashboard</a></li>
    <li class="current">Request</li>
  </ol>
</header>

<section id="review">

  <section id="info">
    <h5>Spec</h5>
    <request-review-summary></request-review-summary>
  </section>

  <section ng-if="isExpert && expertEdit" id="reply">

    <form ng-if="data" id="replyForm" class="expertReplyForm" novalidate name="replyForm" ng-submit="submit(replyForm.$valid, data)">

    <h3>Do you want this AirPair? {{isAdmin}}</h3>

    <div form-group class="expertStatus">
      <input form-control id="expertAvailable" name="expertStatus" ng-model="data.expertStatus" type="radio" value="available" required>
      <label for="expertAvailable">I'm Available</label>

      <input form-control id="expertBusy" name="expertStatus" ng-model="data.expertStatus" type="radio" value="busy" required>
      <label for="expertBusy">No thanks</label>

      <div class="error" ng-if="formGroup.showError(replyForm.expertStatus)" ng-messages="replyForm.expertStatus.$error">
          <div ng-message="required">Required</div>
      </div>
    </div>

    <hr />
    <div form-group ng-if="data.expertStatus">
      <label for="expertComment">Message to customer</label>
      <textarea form-control id="expertComment" name="expertComment" ng-model="data.expertComment"  required></textarea>
      <div class="error" ng-if="formGroup.showError(replyForm.expertComment)" ng-messages="replyForm.expertComment.$error">
          <div ng-message="required">Required</div>
      </div>
    </div>

    <div form-group ng-if="data.expertStatus == 'available'">
      <label for="expertAvailabilityTxt">Availability</label>
      <textarea form-control id="expertAvailabilityTxt" name="expertAvailability" ng-model="data.expertAvailability"></textarea>
      <div class="error" ng-if="formGroup.showError(replyForm.expertAvailability)" ng-messages="replyForm.expertAvailability.$error">
      </div>
    </div>

    <button ng-if="(data.expertStatus && data.expertComment)" type="submit" class="btn btn-primary">Send reply</button>

  </form>

  </section>


  <section class="replies" ng-if="isAnon">
    <form>
      <h3>Want this AirPair?</h3>
      <a id="loginGoogleAuth" track-click="auth" class="btn btn-error" ng-href="{{'/v1/auth/google' + ((returnTo) ? '?returnTo='+returnTo : '') }}" target="_self">Login with google to reply</a>
    </form>
  </section>


  <section ng-if="!isExpert && !isCustomer && !isAnon && !isAdmin" class="replies" ng-if="isAnon">
    <form>
      <h3>Want this AirPair?</h3>
      <a href="/be-an-expert" target="_self" class="btn">Apply to be an AirPair expert</a>
    </form>
  </section>


  <!-- [[{{session.emailVerified}}::{{isCustomer}}]] -->
  <section class="replies" ng-if="!isAnon && !session.emailVerified">
    <div>
      <div class="message noexperts">
        <img class="user" itemprop="image" src="/v1/img/css/chat/pairy.png" />
        <h4>Pairy</h4>
        <div><p ng-if="isCustomer">You must verify your email to see responses.</p></div>
        <div><p ng-if="!isCustomer">You must verify your email before replying.</p></div>
      </div>
      <section>
        <a href="/me" class="btn">Verify Email</a>
      </section>
    </div>
  </section>

  <section class="replies" ng-if="(isCustomer || isAdmin || (isExpert && !expertEdit)) && session.emailVerified">

    <div ng-if="(isCustomer || isAdmin) && replies == 0">
      <div class="message noexperts">
        <img class="user" itemprop="image" src="/v1/img/css/chat/pairy.png" />
        <h4>Pairy</h4>
        <div><p>No experts have replied to your request yet. Consider uping the rate?</p></div>
      </div>
      <section>
        <a href="/help/request/{{r._id}}" class="btn">Edit request</a>
      </section>
    </div>

    <ul>
      <li ng-repeat="s in replies">
        <div>
          <div class="message noexperts">
            <img class="user" itemprop="image" ng-src="{{s.expert.avatar}}?s=100" />
            <h4>{{s.expert.name}}</h4>
            <div><p>{{s.expertComment}}</p><p>{{s.expertAvailability}}</p></div>
          </div>
          <section ng-if="isExpert">
            <strong>${{s.suggestedRate.private.expert}} /hr</strong>
            <a ng-click="setExpertEdit()" class="btn">Edit reply</a>
          </section>
          <section ng-if="(isCustomer || isAdmin) && s.expertStatus == 'available'">
            <strong>${{s.suggestedRate.private.total}} /hr</strong>
            <a href="/billing/book/{{s.expert._id}}/{{r._id}}" class="btn">Book</a>
          </section>
        </div>
      </li>
    </ul>

  </section>

  <section id="brief">

    <div class="entry-author">
      <div class="message">
        <img class="entry-author-image user" itemprop="image" ng-src="{{ (r.by) ? r.by.avatar : r.company.contacts[0].pic }}?s=100" />
        <h4 ng-if="r.by.name">{{r.by.name}}</h4>
        <div ng-bind-html="r.brief | markdownHtml"></div>
      </div>
    </div>

  </section>

  <section id="expertReview">

  </section>

</section>


