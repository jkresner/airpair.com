<section id="admChat">

  <h2>Chat </h2>

    <!-- show -help-request page first -->
    <div class="section">
        <h3>Users on /help/request</h3>
        <div ng-repeat="(memberId, _) in corechat.admin.members.byPage['/help/request']" ng-click="setCurrentUser(memberId)" class="member">
            <img src="/static/img/css/chat/toggle.png" />
            <span member-info="{{memberId}}">
                {{member.name || "Anonymous User"}} 
                <span am-time-ago="member.page.timestamp"></span>
            </span>
        </div>
        <div ng-show="!corechat.admin.members.byPage['/help/request']">
            No users on /help/request
        </div>
    </div>

    <div class="section">
        <h3>Users On Other Pages</h3>
        <div ng-repeat="(page, members) in corechat.admin.members.byPage" ng-hide="page == '/help/request'">
            <div ng-show="members">
                <h4>{{page}}</h4>
                <div ng-repeat="(memberId, _) in members" ng-click="setCurrentUser(memberId)" class="member">
                  <img src="/static/img/css/chat/toggle.png" />
                  <span member-info="{{memberId}}">{{member.name || "Anonymous User"}} <span am-time-ago="member.page.timestamp" class="timestamp"></span></span>
                </div>
            </div>
        </div>
        <div ng-show="!corechat.admin.members.byPage">
            No users on any pages
        </div>
    </div>

    <div class="section">
        <h3>Rooms by Last Message</h3>
        <div ng-repeat="(timestamp, room) in corechat.admin.rooms.byLastMessage">
            <div class="member" ng-click="toggleHistory=!toggleHistory" ng-show="room.info.name">
                [{{toggleHistory? "-" : "+"}}] {{room.info.name}} <span am-time-ago="timestamp" class="timestamp"></span>
            </div>
            <div ng-if="toggleHistory">
                <div ng-repeat="message in room.history">
                    <b member-info="{{message.from}}">{{member.name || "Anonymous User"}}</b>: {{message.body}}
                </div>
                <div ng-show="!room.history.length">
                    No messages :(
                </div>
            </div>
        </div>
    </div>

    <div class="section">
        <h3>All Rooms</h3>
        <div ng-repeat="room in allRooms">
            <div class="member" ng-click="toggleHistory=!toggleHistory" ng-show="room.info.name">
                [{{toggleHistory? "-" : "+"}}] {{room.info.name}}
            </div>
            <div ng-if="toggleHistory">
                <div ng-repeat="message in room.history">
                    <b member-info="{{message.from}}">{{member.name || "Anonymous User"}}</b>: {{message.body}}
                </div>
                <div ng-show="!room.history.length">
                    No messages :(
                </div>
            </div>
        </div>
    </div>

</section>
