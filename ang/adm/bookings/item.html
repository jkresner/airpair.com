<section id="booking" ng-if="booking && booking.participants">

<h3>Booking</h3>


<div class="row">

  <div class="col-md-4">

  <span>{{booking.minutes}} MINS </span>
  <span>{{booking.type}} </span>

  <div>
    <br />
    <span>Status</span>
    <select class="form-control" ng-model="data.status" ng-change="updateStatus(data.status)">
      <option>pending</option>
      <option>confirmed</option>
      <option>followup</option>
      <option>complete</option>
      <option>canceled</option>
    </select>
  </div>

  <section class="datetime">
    <br />
    <div datetime-input id="bookingDatetime" datetime="data.datetime" min-view="minute" date-format="YYYY MMM DD HH:mm Z"></div>

    <a ng-if="datetimeChanged(data.datetime)" ng-click="updateTime(data.datetime)">Update time</a>

    <br /><br />
    <section class="gcal">
      <div ng-if="!data.gcal">No google invitations sent
        <br />
        <br /><a ng-click="addGcal(data.notify)">Create gcal event for <br /> {{previousDatetime.format('YYYY MMM DD HH:mm ZZ')}}</a>
        <br /><input name="gcalNotify" type="checkbox" ng-model="data.notify">
        Notify participants
      </div>
      <div ng-if="data.gcal">
        <p><a href="{{data.gcal.htmlLink}}">{{data.gcal.summary}}</a></p>
        {{data.gcal.start.dateTime | date:'MM/dd/yyyy'}}<br/>
        {{data.gcal.start.dateTime | date:'h:mma'}} to {{data.gcal.end.dateTime | date:'h:mma'}}<br /><br />
        <p><strong>Attendees</strong></p>
        <ul>
          <li ng-repeat="attendee in data.gcal.attendees">
            {{attendee.displayName}}
            ({{attendee.email}})
          </li>
      </div>

  <br />
<div class="spin">
  <ap-hangout-spinner
    hangout-id="booking._id"
    booking="booking"></ap-hangout-spinner>
</div>
    </section>

    <section class="chat">
      <h3>Chat</h3>
      <div ng-if="booking.chat">
        <div ng-if="booking.chat.provider">
          <a target="_blank" href="https://airpair.slack.com/messages/{{booking.chat.data.name}}">  {{booking.chat.data.name}}
            <span ng-if="booking.chat.data.is_archived">(archived)</span>
          </a>{{booking.chat.providerId}} <!-- {{booking.chat.data.created}} -->
          <p class="purpose">{{booking.chat.data.purpose.value}}</p>
          <p class="topic">{{booking.chat.data.topic.value}}</p>
          <ul>
            <li ng-repeat="m in booking.chat.data.members">{{m}}</li>
          </ul>
          <hr />
          <ul class="history">
            <li ng-repeat="m in booking.chat.history">
              <time>{{m.ts}} <b>{{m.user}}</b></time>
              <p>{{m.text}}</p>
            </li>
          </ul>
        </div>
      </div>
      <div ng-if="booking.chatSyncOptions">
        {{booking.chatSyncOptions.length}}<br />
        <div ng-repeat="c in booking.chatSyncOptions">
          <div ng-if="c.provider == 'slack'">
            <b><a target="_blank" href="https://airpair.slack.com/messages/{{c.data.name}}/
            ">{{c.provider}}</a></b>::{{c.data.name}}
            <a ng-click="associateChat('slack',c.data.id)">associate</a>
          </div>
        </div>
      </div>
    </section>

  </section>

  </div>

  <div class="col-md-3">

<div class="customer">
  <h3>Customer</h3>
  <div class="participant" ng-repeat="p in customers">
    <img ng-src="{{p.info.avatar}}" class="user">
    <span>{{p.info.name}} </span>
    <span>{{p.info.email}} </span>
    <div slack-status member="p.chat" userid="p.info._id"></div>
  </div>
</div>


<div class="expert">
  <h3>Expert</h3>
  <div class="participant" ng-repeat="p in experts">
    <img ng-src="{{p.info.avatar}}" class="user">
    <span>{{p.info.name}} </span>
    <span>{{p.info.email}} </span>
    <div slack-status member="p.chat" userid="p.info._id"></div>
  </div>
</div>

  </div>

  <div class="col-md-4">

    <div class="recodings">
      <h3>Recordings</h3>
      <div ng-repeat="r in booking.recordings">
      <span><a target="_blank" href="http://youtube.com/watch?v={{r.data.youTubeId}}">{{r.data.title}}</a></span><br />
      </div><br /><br />
      <input type="text" id="newYouTubeLink" class="form-control" placeholder="Paste YouTube link" ng-model="data.youTubeId"/>
      <input type="submit" ng-click="addYouTubeData(data.youTubeId)" value="Add Recording" /><br /><br />
    </div>

    <div class="feedback">
      <h3>Feedback</h3>
      <p>JK still to build</p>
    </div>


    <div class="request">
      <h3>Request</h3>

      <div ng-if="request">
        This booking comes from <a href="/adm/pipeline/{{request._id}}">{{request.title}}</a>
        <br />
        <br />
        <ul><li ng-repeat="sug in request.suggested | filter: {expertStatus: 'available'}"
        ng-if="sug.expert._id != booking.expertId"
          >
          <a ng-click="swapExpert(sug._id)">Swap</a> {{sug.expert.name}}
        </li></ul>
      </div>
      <div ng-if="!request">Booking is not request associated</div>
    </div>

    <div class="payout">

      <h3>Payout</h3>

      <p ng-if="!order">v0 migrated booking w no associated payout</p>

      <div ng-if="order">
        Order:
        ${{ order.total }}

        <a href="/v1/adm/orders/{{ order._id }}">{{ order._id }}</a>

        <div ng-if="lineForPayout.info.paidout">
          <span style="color:green">paidout</span>
        </div>

        <div ng-if="!lineForPayout.info.paidout">
          <div ng-if="!lineForPayout.info.released">
            <a ng-click="releasePayout()">Release payment</a>
          </div>
          <div ng-if="lineForPayout.info.released">
            <span style="color:blue">Waiting for expert to collect</span>
          </div>
        </div>
      </div>

    </div>

  </div>

</div>

</section>
